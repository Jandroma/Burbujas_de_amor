<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Rompeburbuja de Amor</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #ffe6f0;
      touch-action: none;
      font-family: sans-serif;
    }
    canvas {
      display: block;
      background: linear-gradient(to bottom, #ffc6d9, #fff0f5);
    }
    .controls {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
    }
    button {
      padding: 12px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      background: #ff8ab8;
      color: white;
      box-shadow: 0 4px #d14d7f;
    }
    button:active {
      transform: translateY(2px);
      box-shadow: 0 2px #d14d7f;
    }
  </style>
</head>
<body>
<canvas id="game"></canvas>
<div class="controls">
  <button id="left">◀</button>
  <button id="up">↑</button>
  <button id="right">▶</button>
  <button id="shoot">♥</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let w, h;
function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

// Variables del juego
let player = { x: w / 2, y: h / 2, r: 20, vy: 0, vx: 0 };
let gravity = 0.5;
let letters = [];
let bullets = [];
let score = 0;
let targetWord = "ALEX";
let collected = "";
let level = 0;
let phrases = [
  "ALEX", "TE QUIERO, ALEX", "ERES MI TODO", "CADA LETRA TUYA", 
  "ES MI ALEGRÍA", "MI CORAZÓN LATE", "POR TI", "HASTA EL FINAL", 
  "NO HAY NADIE MÁS", "TE AMO, ALEX"
];

// Genera una letra aleatoria
function randomLetter() {
  const abc = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  return abc[Math.floor(Math.random() * abc.length)];
}

function spawnLetter() {
  let letter = {
    x: Math.random() * (w - 30) + 15,
    y: -20,
    char: randomLetter(),
    hit: false
  };
  // Asegura que al menos algunas letras sean del objetivo
  if (Math.random() < 0.3 && collected.length < targetWord.length)
    letter.char = targetWord[collected.length];
  letters.push(letter);
}

function update() {
  player.vy += gravity;
  player.y += player.vy;
  player.x += player.vx;
  player.x = Math.max(player.r, Math.min(w - player.r, player.x));
  player.y = Math.max(player.r, Math.min(h - player.r, player.y));

  letters.forEach(l => l.y += 2);
  bullets.forEach(b => b.y -= 8);

  // Colisiones bala-letra
  bullets.forEach((b, bi) => {
    letters.forEach((l, li) => {
      let dx = b.x - l.x;
      let dy = b.y - l.y;
      if (Math.sqrt(dx * dx + dy * dy) < 20 && !l.hit) {
        l.hit = true;
        if (l.char === targetWord[collected.length]) {
          collected += l.char;
          score += 10;
        } else {
          if (collected.length > 0) collected = collected.slice(0, -1);
        }
        bullets.splice(bi, 1);
      }
    });
  });

  letters = letters.filter(l => l.y < h && !l.hit);
  bullets = bullets.filter(b => b.y > 0);

  if (collected === targetWord) {
    level++;
    if (level >= phrases.length) level = 0;
    targetWord = phrases[level].replace(/[^A-Z]/gi, "");
    collected = "";
  }
}

function draw() {
  ctx.clearRect(0, 0, w, h);
  // Fondo
  ctx.fillStyle = "#fff0f5";
  ctx.fillRect(0, 0, w, h);

  // Letras
  ctx.font = "20px Arial";
  letters.forEach(l => {
    ctx.fillStyle = l.char === targetWord[collected.length] ? "#ff69b4" : "#999";
    ctx.fillText(l.char, l.x, l.y);
  });

  // Jugador
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.r, 0, Math.PI * 2);
  ctx.fillStyle = "#ff3366";
  ctx.fill();

  // Balas
  ctx.fillStyle = "#d14d7f";
  bullets.forEach(b => ctx.fillRect(b.x - 2, b.y - 10, 4, 10));

  // Texto
  ctx.fillStyle = "#333";
  ctx.fillText("Frase: " + phrases[level], 10, 20);
  ctx.fillText("Progreso: " + collected, 10, 40);
  ctx.fillText("Puntos: " + score, 10, 60);
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}
gameLoop();

// Controles
document.getElementById("left").addEventListener("touchstart", () => player.vx = -5);
document.getElementById("right").addEventListener("touchstart", () => player.vx = 5);
document.getElementById("left").addEventListener("touchend", () => player.vx = 0);
document.getElementById("right").addEventListener("touchend", () => player.vx = 0);
document.getElementById("up").addEventListener("touchstart", () => player.vy = -8);
document.getElementById("shoot").addEventListener("touchstart", () => {
  bullets.push({ x: player.x, y: player.y - player.r });
});

setInterval(spawnLetter, 1000);
</script>
</body>
</html>
