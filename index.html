<!DOCTYPE html><html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Rompeburbuja de Amor</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      user-select: none;
    }
    html, body {
      width: 100%;
      height: 100%;
      background: linear-gradient(to bottom, #ffe0e0, #ffc0cb);
      overflow: hidden;
    }
    canvas {
      background: #fff;
      display: block;
      touch-action: none;
    }
    #controls {
      position: fixed;
      bottom: 0;
      width: 100%;
      height: 100px;
      background: #000;
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 10;
    }
    button {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: none;
      background: #ff6781;
      color: white;
      font-size: 24px;
      font-weight: bold;
    }
    #progress {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.7);
      padding: 10px 20px;
      border-radius: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <canvas id="game"></canvas>
  <div id="progress"></div>
  <div id="controls">
    <button id="left">←</button>
    <button id="right">→</button>
    <button id="up">↑</button>
    <button id="shoot">♥</button>
  </div>
  <script>
    const frases = [
      "ÁLEX",
      "TE QUIERO ÁLEX",
      "ERES LO MEJOR",
      "MI VIDA CONTIGO",
      "NO DEJO DE PENSAR EN TI",
      "TÚ Y YO PARA SIEMPRE",
      "GRACIAS POR ESTAR",
      "ME ENCANTAS",
      "MI PERSONA FAVORITA",
      "TE AMO CON EL ALMA"
    ];
    let nivel = parseInt(localStorage.getItem("nivel")) || 0;
    let canvas = document.getElementById("game");
    let ctx = canvas.getContext("2d");
    let width = window.innerWidth;
    let height = window.innerHeight - 100;
    canvas.width = width;
    canvas.height = height;let corazon = { x: width / 2, y: height - 120, r: 20, vy: 0 };
let letras = [];
let proyectiles = [];
let fraseObjetivo = frases[nivel];
let recolectadas = [];
let teclas = {};

function generarLetra() {
  let posibles = "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ";
  let necesarias = fraseObjetivo.replace(/ /g, "").split("").filter(l => !recolectadas.includes(l));
  let letra = Math.random() < 0.6 && necesarias.length > 0
    ? necesarias[Math.floor(Math.random() * necesarias.length)]
    : posibles[Math.floor(Math.random() * posibles.length)];
  letras.push({ x: Math.random() * (width - 40), y: -30, l: letra });
}

function dibujar() {
  ctx.clearRect(0, 0, width, height);

  // Letras
  ctx.font = "28px Arial";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  letras.forEach((letra, i) => {
    ctx.beginPath();
    ctx.arc(letra.x, letra.y, 30, 0, Math.PI * 2);
    ctx.fillStyle = "#ffb6c1";
    ctx.fill();
    ctx.fillStyle = "#000";
    ctx.fillText(letra.l, letra.x, letra.y);
    letra.y += 2;
    if (letra.y > height) letras.splice(i, 1);
  });

  // Proyectiles
  proyectiles.forEach((p, i) => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, 10, 0, Math.PI * 2);
    ctx.fillStyle = "red";
    ctx.fill();
    p.y -= 6;

    letras.forEach((letra, j) => {
      let dx = letra.x - p.x;
      let dy = letra.y - p.y;
      if (Math.sqrt(dx*dx + dy*dy) < 40) {
        if (fraseObjetivo.replace(/ /g, "").includes(letra.l)) {
          if (!recolectadas.includes(letra.l)) recolectadas.push(letra.l);
        } else {
          recolectadas.pop();
        }
        letras.splice(j, 1);
        proyectiles.splice(i, 1);
      }
    });

    if (p.y < 0) proyectiles.splice(i, 1);
  });

  // Corazón
  ctx.beginPath();
  ctx.arc(corazon.x, corazon.y, corazon.r, 0, Math.PI * 2);
  ctx.fillStyle = "red";
  ctx.fill();

  // Gravedad
  corazon.vy += 0.4;
  corazon.y += corazon.vy;
  if (corazon.y > height - 120) {
    corazon.y = height - 120;
    corazon.vy = 0;
  }

  // Movimiento lateral
  if (teclas["left"] && corazon.x > 20) corazon.x -= 4;
  if (teclas["right"] && corazon.x < width - 20) corazon.x += 4;

  document.getElementById("progress").innerText = recolectadas.join("") + " / " + fraseObjetivo;

  if (recolectadas.length === fraseObjetivo.replace(/ /g, "").length) {
    nivel++;
    if (nivel >= frases.length) nivel = 0;
    localStorage.setItem("nivel", nivel);
    fraseObjetivo = frases[nivel];
    recolectadas = [];
    letras = [];
    proyectiles = [];
    alert("¡Nivel completado! Próxima frase: " + fraseObjetivo);
  }

  requestAnimationFrame(dibujar);
}

setInterval(generarLetra, 1000);

document.getElementById("up").addEventListener("touchstart", () => {
  corazon.vy = -8;
});
document.getElementById("left").addEventListener("touchstart", () => teclas["left"] = true);
document.getElementById("left").addEventListener("touchend", () => teclas["left"] = false);
document.getElementById("right").addEventListener("touchstart", () => teclas["right"] = true);
document.getElementById("right").addEventListener("touchend", () => teclas["right"] = false);
document.getElementById("shoot").addEventListener("touchstart", () => {
  proyectiles.push({ x: corazon.x, y: corazon.y });
});

dibujar();

  </script>
</body>
</html>
