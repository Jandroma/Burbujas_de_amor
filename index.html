<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Burbujas de Amor</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #ffe6f0;
      touch-action: none;
      font-family: 'Arial', sans-serif;
    }
    canvas {
      display: block;
      background: #ffccdd;
    }
    #controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 10;
    }
    .btn {
      width: 60px;
      height: 60px;
      background: pink;
      border: none;
      border-radius: 50%;
      font-size: 20px;
      box-shadow: 2px 2px 8px #0003;
      user-select: none;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="controls">
    <button class="btn" id="leftBtn">←</button>
    <button class="btn" id="upBtn">↑</button>
    <button class="btn" id="rightBtn">→</button>
    <button class="btn" id="shootBtn">❤</button>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let heart = { x: canvas.width / 2, y: canvas.height / 2, r: 30, dx: 0, dy: 0 };
    let letters = [];
    let bullets = [];
    let targetWord = "ÁLEX";
    let collected = "";
    let points = 0;
    let level = 0;
    const phrases = [
      "ÁLEX", "TE QUIERO", "TE QUIERO, ÁLEX", "SIEMPRE CONTIGO",
      "ERES MI TODO", "MI VIDA ERES TÚ", "NUNCA TE OLVIDO",
      "AMOR INFINITO", "CADA DÍA MÁS", "JUNTOS POR SIEMPRE"
    ];

    function spawnLetter() {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZÁÉÍÓÚ";
      const needed = targetWord.replaceAll(" ", "").split("").filter(c => !collected.includes(c));
      const pool = [...needed, ...Array(5).fill(null).map(() => chars[Math.floor(Math.random() * chars.length)])];
      const char = pool[Math.floor(Math.random() * pool.length)];
      letters.push({
        char,
        x: Math.random() * (canvas.width - 40) + 20,
        y: -50,
        size: 36
      });
    }

    setInterval(spawnLetter, 1200);

    function drawHeart() {
      ctx.beginPath();
      ctx.fillStyle = "red";
      const { x, y, r } = heart;
      ctx.moveTo(x, y);
      ctx.bezierCurveTo(x - r, y - r, x - r * 2, y + r / 2, x, y + r * 2);
      ctx.bezierCurveTo(x + r * 2, y + r / 2, x + r, y - r, x, y);
      ctx.fill();
    }

    function drawLetters() {
      for (let l of letters) {
        ctx.fillStyle = "#333";
        ctx.font = `${l.size}px bold Arial`;
        ctx.fillText(l.char, l.x, l.y);
      }
    }

    function drawBullets() {
      ctx.fillStyle = "pink";
      for (let b of bullets) {
        ctx.beginPath();
        ctx.arc(b.x, b.y, 8, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function drawUI() {
      ctx.fillStyle = "#222";
      ctx.font = "20px sans-serif";
      ctx.fillText(`Frase: ${phrases[level]}`, 20, 30);
      ctx.fillText(`Letras: ${collected}`, 20, 60);
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      heart.x += heart.dx;
      heart.y += heart.dy;
      heart.dy += 0.3;

      if (heart.x < 0) heart.x = 0;
      if (heart.x > canvas.width) heart.x = canvas.width;
      if (heart.y > canvas.height - heart.r) {
        heart.y = canvas.height - heart.r;
        heart.dy = 0;
      }

      letters.forEach(l => l.y += 2);
      bullets.forEach(b => b.y -= 5);

      bullets = bullets.filter(b => b.y > 0);
      letters = letters.filter(l => l.y < canvas.height);

      for (let b of bullets) {
        for (let i = letters.length - 1; i >= 0; i--) {
          let l = letters[i];
          if (
            b.x > l.x - 10 && b.x < l.x + 30 &&
            b.y > l.y - 30 && b.y < l.y
          ) {
            if (targetWord.includes(l.char)) {
              if (!collected.includes(l.char)) {
                collected += l.char;
                points += 10;
              }
            } else {
              collected = collected.slice(0, -1);
              points -= 5;
            }
            letters.splice(i, 1);
            break;
          }
        }
      }

      if (collected.length >= targetWord.replaceAll(" ", "").length) {
        level++;
        if (level >= phrases.length) {
          alert("¡Has completado todos los niveles!");
          level = 0;
          collected = "";
          targetWord = phrases[level].toUpperCase();
        } else {
          alert("Nivel superado: " + phrases[level]);
          collected = "";
          targetWord = phrases[level].toUpperCase();
        }
      }

      drawHeart();
      drawLetters();
      drawBullets();
      drawUI();

      requestAnimationFrame(gameLoop);
    }

    gameLoop();

    document.getElementById("leftBtn").ontouchstart = () => heart.dx = -3;
    document.getElementById("leftBtn").ontouchend = () => heart.dx = 0;
    document.getElementById("rightBtn").ontouchstart = () => heart.dx = 3;
    document.getElementById("rightBtn").ontouchend = () => heart.dx = 0;
    document.getElementById("upBtn").ontouchstart = () => heart.dy = -6;
    document.getElementById("shootBtn").ontouchstart = () => {
      bullets.push({ x: heart.x, y: heart.y - heart.r });
    };
  </script>
</body>
</html>
